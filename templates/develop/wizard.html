{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="flex flex-col items-center justify-start min-h-screen px-4 pt-8 md:px-6 md:pt-12 bg-primary-light">

  <!-- Logo -->
  <img src="{% static 'img/logo.png' %}" alt="Logo Cuentas Claras" class="h-16 md:h-20 mb-6">

  <!-- Flujo de pasos -->
  <div class="flex items-center justify-center mb-8 md:mb-10 space-x-4 md:space-x-8">
    <div class="wizard-step flex flex-col items-center">
      <div class="w-6 h-6 rounded-full bg-primary-dark flex items-center justify-center text-white text-sm">1</div>
      <p class="mt-2 text-xs md:text-sm font-body text-primary-dark">Participantes</p>
    </div>
    <div id="conector-1-2" class="relative wizard-connector overflow-hidden w-10 h-1 bg-neutral-light md:w-16">
      <div class="barra-interna absolute left-0 top-0 h-full bg-primary-dark transition-all duration-500 ease-linear" style="width: 0%;"></div>
    </div>
    <div class="wizard-step flex flex-col items-center">
      <div class="w-6 h-6 rounded-full bg-neutral-light flex items-center justify-center text-primary-dark text-sm">2</div>
      <p class="mt-2 text-xs md:text-sm font-body text-neutral-mid">Gastos</p>
    </div>
    <div id="conector-2-3" class="relative wizard-connector overflow-hidden w-10 h-1 bg-neutral-light md:w-16">
      <div class="barra-interna absolute left-0 top-0 h-full bg-primary-dark transition-all duration-500 ease-linear" style="width: 0%;"></div>
    </div>
    <div class="wizard-step flex flex-col items-center">
      <div class="w-6 h-6 rounded-full bg-neutral-light flex items-center justify-center text-primary-dark text-sm">3</div>
      <p class="mt-2 text-xs md:text-sm font-body text-neutral-mid">Resultado</p>
    </div>
  </div>

  <!-- Paso 1: Participantes -->
  <div id="step-participants" class="flex flex-col w-full max-w-sm md:max-w-md p-6 md:p-8 mb-8 bg-white rounded-2xl shadow-lg transition-all duration-300 ease-in-out">
    <h2 class="text-xl md:text-2xl font-title text-primary-dark mb-4">¿Quiénes compartieron los gastos?</h2>
    <p class="text-xs md:text-sm font-body text-neutral-mid mb-6">Añade a todas las personas que participaron en el gasto.</p>

    <div class="flex flex-col md:flex-row w-full gap-2 mb-2">
      <input 
        type="text" 
        id="friend-input"
        placeholder="Nombre del participante"
        class="flex-1 px-4 py-2 border border-neutral-light rounded-lg font-input text-primary-dark focus:outline-none focus:ring-2 focus:ring-primary-dark"
      >
      <button 
        id="add-friend" 
        class="bg-primary hover:bg-primary-dark text-white font-bold px-4 md:px-5 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95">
        Agregar
      </button>
    </div>
    <div id="error-message" class="h-5 text-secondary hover:text-secondary-hover text-xs text-center transform transition-all duration-500 ease-in-out opacity-0 translate-y-2 mb-0 mt-2"></div>

    <div id="friends-list" class="flex flex-wrap gap-2 mb-8 mt-2 overflow-hidden transition-all duration-500 ease-in-out">
      <!-- Aquí se agregan dinámicamente los chips -->
    </div>

    <div class="flex justify-center">
      <button 
        id="go-to-step-2" 
        class="bg-secondary hover:bg-secondary-hover text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95">
        Continuar
      </button>
    </div>
  </div>

  <!-- Paso 2: Gastos -->
  <div id="step-gastos" class="hidden flex flex-col w-full max-w-sm md:max-w-md p-6 md:p-8 mb-8 bg-white rounded-2xl shadow-lg transition-all duration-300 ease-in-out">
    <h2 class="text-xl md:text-2xl font-title text-primary-dark mb-4">¿Qué gastos se realizaron?</h2>
    <p class="text-xs md:text-sm font-body text-neutral-mid mb-6">Agrega cada gasto indicando quién pagó y quiénes participaron.</p>

    <button id="add-gasto" class="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-6 rounded-lg mb-6 transition-all duration-300 transform hover:scale-105 active:scale-95">
      + Agregar gasto
    </button>

    <div id="gastos-container" class="flex flex-col gap-6">
      <!-- Aquí se agregan las tarjetas de gastos dinámicamente -->
    </div>

    <div class="flex justify-center mt-6">
      <button id="go-to-step-3" class="bg-secondary hover:bg-secondary-hover text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 active:scale-95">
        Continuar
      </button>
    </div>
  </div>

</div>

<!-- Scripts -->
<script type="module" src="{% static 'js/stateManager.js' %}"></script>
<script type="module" src="{% static 'js/domHandlers.js' %}"></script>
<script type="module" src="{% static 'js/apiService.js' %}"></script>
<script type="module" src="{% static 'js/ResultRenderer.js' %}"></script>
<script type="module" src="{% static 'js/utils.js' %}"></script>

<script type="module">
  import { initializeDOMHandlers, initializeGastosHandlers } from "{% static 'js/domHandlers.js' %}";
  import { initializeWizardNavigation } from "{% static 'js/utils.js' %}";
  document.addEventListener('DOMContentLoaded', () => {
    initializeDOMHandlers();
    initializeGastosHandlers();
    initializeWizardNavigation();
  });
</script>
{% endblock %}
